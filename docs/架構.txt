pdf_editor/
  main.py
    # 入口：建立 PDFModel / PDFView / PDFController

  model/
    pdf_model.py
      # 核心 Model：
      # - 多分頁 session registry（DocumentSession）
      # - fitz.Document 擁有權
      # - 文字編輯交易流程（驗證 / 回滾）
      # - 新增文字框（add_text）插入流程
      # - 開檔、存檔、頁面操作
      # - 與 CommandManager、ToolManager 整合
    text_block.py
      # 文字索引：TextBlock / EditableSpan(run) / EditableParagraph(paragraph)
    edit_commands.py
      # Undo/Redo：EditTextCommand / AddTextboxCommand / SnapshotCommand / CommandManager
    tools/
      __init__.py
      base.py
        # ToolExtension 介面（session lifecycle / overlay / save hooks）
      manager.py
        # ToolManager：註冊並管理內建工具（annotation, watermark, search, ocr）
      annotation_tool.py
        # 註解工具（highlight/rect/freetext/顯示切換/保護註解）
      watermark_tool.py
        # 浮水印工具（CRUD、渲染、嵌入與還原 metadata、dirty 狀態）
      search_tool.py
        # 文字搜尋工具
      ocr_tool.py
        # OCR 工具（pytesseract + Pillow；缺依賴時回傳清楚 RuntimeError）

  controller/
    pdf_controller.py
      # Controller：
      # - 接收 View signals
      # - 呼叫 Model 與 model.tools.* API
      # - 維護每個 session 的 UI 狀態（頁碼 / 縮放 / 模式 / 搜尋）
      # - 協調重繪、列印、Undo/Redo

  view/
    pdf_view.py
      # Qt UI：
      # - Tab 文件介面、工具面板、畫布、事件信號
      # - 不直接做資料層業務邏輯
      # - 編輯意圖分流：edit_existing / add_new

  src/
    printing/
      # 列印子系統：dialog / dispatcher / page selection / layout / drivers
      print_dialog.py
      dispatcher.py
      page_selection.py
      layout.py
      pdf_renderer.py
      qt_bridge.py
      errors.py
      base_driver.py
      platforms/
        win_driver.py
        linux_driver.py
        mac_driver.py

  utils/
    helpers.py
      # 共用工具：頁碼解析、pixmap 轉換、錯誤提示等

  docs/
    README.md
    README.zh-TW.md
    ARCHITECTURE.md
    FEATURES.md
    架構.txt
    solutions.md
    Methodology_for_Writing_Docs.md

  test_scripts/
    # 測試與壓力測試腳本（pytest tests + script-style 測試）

目前主要工作流程：
1) 編輯既有文字：
   view(sig_edit_text) -> controller(EditTextCommand) -> model(edit_text)

2) 新增頁面文字框：
   view(sig_add_textbox) -> controller(AddTextboxCommand) -> model(add_textbox)

3) 復原 / 重做：
   view -> controller -> command_manager -> command restore -> controller refresh

文件分工規則：
- 行為規格：docs/FEATURES.md
- 實作對應：docs/ARCHITECTURE.md
- 問題修正與決策歷史：docs/solutions.md
